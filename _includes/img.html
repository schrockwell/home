{%- assign src = include.src -%}
{%- assign cap = include.caption | default: "" -%}
{%- assign alt = include.alt | default: cap -%}

{%- comment -%}
  Supports both relative and absolute paths:
    Relative: src="metar/hero.jpeg" (resolved from page.dir)
    Absolute: src="/hw/metar/hero.jpeg" (starts with /)
{%- endcomment -%}
{%- assign first_char = src | slice: 0 -%}
{%- if first_char == "/" -%}
  {%- assign full_src = src | slice: 1, 9999 -%}
{%- else -%}
  {%- assign full_src = page.dir | append: src | remove_first: "/" -%}
{%- endif -%}

{%- assign src_parts = full_src | split: "/" -%}
{%- assign src_file = src_parts | last -%}
{%- assign dir_parts = src_parts | pop -%}
{%- assign src_dir = dir_parts | join: "/" -%}

{%- assign thumb_path = "/" | append: src_dir | append: "/images/thumb/" | append: src_file -%}
{%- assign full_path = "/" | append: src_dir | append: "/images/full/" | append: src_file -%}
{%- assign href = include.href | default: full_path -%}

<figure class="img">
  <a href="{{ href }}" rel="noopener">
    <img
      src="{{ thumb_path }}"
      alt="{{ alt | escape }}"
      loading="lazy"
      decoding="async"
    >
  </a>
  {%- if cap -%}<figcaption>{{ cap }}</figcaption>{%- endif -%}
</figure>
